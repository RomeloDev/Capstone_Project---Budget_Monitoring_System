{% extends "approving_officer_base_template/dashboard.html" %}
{% load humanize %}

{% block title %}Department PRE Requests{% endblock %}

{% block main-content %}
<h1 class="text-3xl font-bold mb-4">Department PRE Requests</h1>
<p class="text-gray-600">All submitted PRE forms with status "Pending".</p>

<div class="overflow-x-auto mt-6">
  <table class="min-w-full bg-white border border-gray-300">
    <thead class="bg-gray-100">
      <tr>
        <th class="py-2 px-4 border-b text-left">ID</th>
        <th class="py-2 px-4 border-b text-left">Department</th>
        <th class="py-2 px-4 border-b text-left">Submitted By</th>
        <th class="py-2 px-4 border-b text-left">Submitted At</th>
        <th class="py-2 px-4 border-b text-left">Status</th>
        <th class="py-2 px-4 border-b text-left">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% if pres %}
        {% for pre in pres %}
        <tr class="border-b">
          <td class="py-2 px-4">{{ pre.id }}</td>
          <td class="py-2 px-4">{{ pre.department }}</td>
          <td class="py-2 px-4">{{ pre.submitted_by.get_full_name|default:pre.submitted_by.username }}</td>
          <td class="py-2 px-4">{{ pre.created_at }}</td>
          <td class="py-2 px-4">
            {% if pre.status == 'Pending' %}
              <span class="px-3 py-1 rounded-full bg-yellow-100 text-yellow-800 text-sm">Pending</span>
            {% elif pre.status == 'Approved' %}
              <span class="px-3 py-1 rounded-full bg-green-100 text-green-800 text-sm">Approved</span>
            {% else %}
              <span class="px-3 py-1 rounded-full bg-red-100 text-red-800 text-sm">Rejected</span>
            {% endif %}
          </td>
          <td class="py-2 px-4 space-x-2">
            <a href="{% url 'ao_preview_pre' pre.id %}" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">View</a>
            <form method="post" action="{% url 'ao_handle_pre_action' pre.id %}" class="inline">
              {% csrf_token %}
              <button type="submit" name="action" value="approve" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">Approve</button>
              <button type="submit" name="action" value="reject" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 ml-2">Reject</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="5" class="py-4 text-center text-gray-600">No pending PRE requests.</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}



