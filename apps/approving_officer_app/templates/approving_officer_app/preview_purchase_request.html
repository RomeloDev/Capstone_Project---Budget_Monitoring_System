{% extends "approving_officer_base_template/dashboard.html" %}

{% load humanize %}

{% block title %}
    Purchase Request Preview
{% endblock title %}

{% block main-content %}
<main class="content">
  <header class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="font-semibold text-2xl">Submitted Purchase Request Preview</h1>
      <p class="text-gray-600 text-sm">Review the details of your submitted Purchase Request.</p>
    </div>
    <button type="button" class="inline-flex items-center gap-2 px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      Download as Word
    </button>
  </header>
  <section class="max-w-5xl mx-auto mb-6 rounded-lg bg-white p-4 shadow-sm ring-1 ring-gray-200">
    <div class="flex flex-col items-center justify-between gap-4 text-center md:flex-row md:text-left">
      <div class="flex items-center gap-4">
        <div class="h-14 w-14 rounded-full bg-gray-100 ring-1 ring-gray-200">
          <img src="https://bisu.edu.ph/wp-content/themes/gwt-wordpress-gwt-wordpress-26.0.0/images/bisu-logo2.png" 
               alt="Bisu Logo" 
               class="h-full w-full object-cover rounded-full">
        </div>
        <div>
          <p class="text-xs uppercase tracking-wider text-gray-500">Republic of the Philippines</p>
          <h1 class="text-lg font-semibold">Bohol Island State University</h1>
          <p class="text-xs text-gray-500">[Address, Zip Code, Bohol, Philippines]</p>
          <p class="text-[11px] text-gray-500">Office of the __________</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded bg-gray-100 ring-1 ring-gray-200">
          <img src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Bagong_Pilipinas_logo.png" alt="Bagong Pilipinas Logo">
        </div>
        <div class="h-10 w-20 rounded bg-gray-100 ring-1 ring-gray-200">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQyAcSvFonC-PFbOnMUYYjRlVgb9fNbgt_lFw&s" alt="ISO Logo">
        </div>
      </div>
    </div>
    <div class="mt-4 border-t pt-3 text-center">
      <h2 class="text-xl font-bold tracking-wide">PURCHASE REQUEST</h2>
    </div>
  </section>
  <div class="max-w-5xl mx-auto bg-white shadow rounded-lg p-6">
    
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-semibold">Purchase Request Preview</h1>
      <span class="text-sm text-gray-500">PR No.: {{ pr.pr_no }}</span>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div>
        <p class="text-sm text-gray-500">Entity Name</p>
        <p class="font-medium">{{ pr.entity_name }}</p>
      </div>
      <div>
        <p class="text-sm text-gray-500">Fund Cluster</p>
        <p class="font-medium">{{ pr.fund_cluster }}</p>
      </div>
      <div>
        <p class="text-sm text-gray-500">Office/Section</p>
        <p class="font-medium">{{ pr.office_section }}</p>
      </div>
      <div>
        <p class="text-sm text-gray-500">Responsibility Center Code</p>
        <p class="font-medium">{{ pr.responsibility_center_code }}</p>
      </div>
    </div>

    <div class="border-t pt-4 mb-6">
      <p class="text-sm text-gray-500">Purpose</p>
      <p class="font-medium whitespace-pre-line">{{ pr.purpose }}</p>
    </div>

    <div class="border rounded-lg overflow-hidden mb-6">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Stock/Property No</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Unit</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Item Description</th>
            <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Qty</th>
            <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Unit Cost</th>
            <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% for item in pr.items.all %}
          <tr>
            <td class="px-4 py-2">{{ item.stock_property_no }}</td>
            <td class="px-4 py-2">{{ item.unit }}</td>
            <td class="px-4 py-2">{{ item.item_description }}</td>
            <td class="px-4 py-2 text-right">{{ item.quantity }}</td>
            <td class="px-4 py-2 text-right">₱ {{ item.unit_cost|intcomma }}</td>
            <td class="px-4 py-2 text-right">₱ {{ item.total_cost|intcomma }}</td>
          </tr>
          {% empty %}
          <tr>
            <td class="px-4 py-6 text-center text-gray-500" colspan="6">No items.</td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr class="bg-gray-50">
            <td class="px-4 py-2 text-right font-semibold" colspan="5">Grand Total</td>
            <td class="px-4 py-2 text-right font-bold">₱ {{ pr.total_amount|intcomma }}</td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="bg-gray-50 rounded p-4">
        <p class="text-sm text-gray-500">Budget Allocation</p>
        {% if pr.budget_allocation %}
        <p class="font-medium">
          {{ pr.budget_allocation.approved_budget.title }} - {{ pr.budget_allocation.approved_budget.period }}
          (Allocated: ₱ {{ pr.budget_allocation.total_allocated|intcomma }})
        </p>
        {% else %}
        <p class="text-gray-500">—</p>
        {% endif %}
      </div>
      <div class="bg-gray-50 rounded p-4">
        <p class="text-sm text-gray-500">Source of Fund</p>
        {% if pr.source_pre %}
        <p class="font-medium">
          {{ pr.source_item_key|default:'—'|title }} {{ pr.source_quarter }} - ₱ {{ pr.source_amount|intcomma }}
        </p>
        {% else %}
        <p class="text-gray-500">—</p>
        {% endif %}
      </div>
    </div>
  </div>
</main>
{% endblock main-content %}