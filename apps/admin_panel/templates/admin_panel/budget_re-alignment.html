{% extends "admin_base_template/dashboard.html" %}

{% load humanize %}

{% block title %}
    Manage Budget Re-Alignment
{% endblock title %}

{% block main-content %}
<div class="flex flex-col w-full">
    <header class="bg-blue-600 px-4 py-2 text-white shadow-sm rounded-lg">
        <h1 class="text-[20px] font-bold">Budget Re-Alignment Requests</h1>
        <p class="text-sm text-blue-100 mt-1">View and manage all submitted budget re-alignment requests from end users.</p>
    </header>
<main class="p-6 bg-gray-100 flex-1 space-y-6">

  <!-- Budget Re-Alignment Requests -->
  <section class="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
    <header class="mb-4">
      <h1 class="text-2xl font-bold text-gray-800">Budget Re-Alignment Requests</h1>
      <p class="text-gray-600">View and manage all submitted budget re-alignment requests from end users.</p>
    </header>

    <table class="min-w-full text-sm border border-gray-300">
      <thead class="bg-gray-100 text-gray-700 font-semibold">
        <tr>
          <th class="px-4 py-2 text-left">Date Submitted</th>
          <th class="px-4 py-2 text-left">Submitted By</th>
          <th class="px-4 py-2 text-left">Target PAPP</th>
          <th class="px-4 py-2 text-left">Source PAPP</th>
          <th class="px-4 py-2 text-left">Amount (â‚±)</th>
          <th class="px-4 py-2 text-left">Status</th>
          <th class="px-4 py-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody class="text-gray-700">
        {% if re_alignment_request %}
          {% for request in re_alignment_request %}
          <tr class="border-t hover:bg-gray-50">
            <td class="px-4 py-2">{{ request.created_at }}</td>
            <td class="px-4 py-2">{{ request.requested_by.department }}</td>
            <td class="px-4 py-2">{{ request.target_papp }}</td>
            <td class="px-4 py-2">{{ request.source_papp }}</td>
            <td class="px-4 py-2">&#8369; {{ request.amount|intcomma }}</td>

            <!-- Status Styling -->
            <td class="px-4 py-2 font-semibold">
              {% if request.status == 'Pending' %}
                <span class="text-yellow-600">{{ request.status }}</span>
              {% elif request.status == 'Approved' %}
                <span class="text-blue-600">{{ request.status }}</span>
              {% elif request.status == 'Rejected' %}
                <span class="text-red-600">{{ request.status }}</span>
              {% else %}
                <span class="text-gray-500">{{ request.status }}</span>
              {% endif %}
            </td>

            <!-- Actions -->
            <td class="px-4 py-2 space-x-2 whitespace-nowrap">
              <a href="#" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">View</a>

              {% if request.status == 'Pending' %}
              <form method="post" action="{% url 'handle_re_alignment_request_action' request.id %}" class="inline">
                {% csrf_token %}
                <button type="submit" name="action" value="approve" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">Approve</button>
                <button type="submit" name="action" value="reject" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 ml-2">Reject</button>
              </form>
              {% else %}
              <span class="inline-block bg-gray-400 text-white px-3 py-1 rounded cursor-not-allowed">{{ request.status|title }}</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="7" class="py-4 text-center text-gray-500">No requests found.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>

    <!-- Django Messages -->
    {% if messages %}
      {% for message in messages %}
        <p class="mt-4 text-center text-base font-medium
          {% if message.tags == 'success' %}text-green-600
          {% elif message.tags == 'error' %}text-red-600
          {% else %}text-gray-800{% endif %}">
          {{ message }}
        </p>
      {% endfor %}
    {% endif %}
  </section>
</main>

</div>
{% endblock main-content %}
